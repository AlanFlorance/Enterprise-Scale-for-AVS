{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "AVS Landing Zone Accelerator",
            "steps": [
                {
                    "name": "basics",
                    "label": "Azure core setup",
                    "subLabel": {
                        "preValidation": "Provide deployment prefix for the resource groups and resources that will be created.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "avsBasics",
                    "elements": [
                        {
                            "name": "avsDeploymentScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": []
                            }
                        },
                        {
                            "name": "avsSharedServices",
                            "type": "Microsoft.Common.InfoBox",
                            "options": {
                                "text": "The subscription and location selected in this step will be used to deploy the AVS Workload Landing Zone resources (Private Cloud, Virtual Networks, VMs etc.).",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "avsWorkloadSubscription",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Deployment",
                            "elements": [
                                {
                                    "name": "info",
                                    "type": "Microsoft.Common.TextBlock",
                                    "options": {
                                        "text": "Azure AVS Landing Zones will create the resource group hierarchy under the subscriptions with the prefix provided at this step.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization"
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "avsDeploymentPrefix",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Deployment prefix",
                            "toolTip": "Provide a prefix (max 8 characters) for the resource groups and resources created as part of AVS landing zones.",
                            "placeholder": "Example: AVS",
                            "constraints": {
                                "required": true,
                                "regex": "^[a-z0-9A-Z-]{1,8}$",
                                "validationMessage": "The prefix must be 1-8 characters."
                            }
                        },
                        {
                            "name": "rbacInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Azure AVS Landing Zones ARM deployment requires contributor access at the subscription scope. Visit this link to get more information on RBAC permissions and scopes.",
                                "uri": "https://docs.microsoft.com/en-us/azure/role-based-access-control/scope-overview",
                                "style": "Warning"
                            }
                        }
                    ]
                },
                {
                    "name": "azureNetwork",
                    "label": "Networking and Connectivity",
                    "bladeTitle": "azureNetworkingSettings",
                    "elements": [
                        {
                            "name": "Info",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "On-Premise Connectivity",
                            "elements": [
                                {
                                    "name": "onpreminfo1",
                                    "type": "Microsoft.Common.TextBlock",
                                    "options": {
                                        "text": "On-premise connectivity is also typically required especially for any migrations of workload via HCX. If VPN is the current method of Azure to On-premise connectivity, then we will need an Azure Route Server to act as the route forwarder from the VPN Gateway to the ExpressRoute Gateway deployed in the section above",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/en-us/azure/azure-vmware/request-host-quota-azure-vmware-solution?WT.mc_id=Portal-VMCP#request-host-quota-for-ea-customers"
                                        }
                                    }
                                },
                                {
                                    "name": "onpreminfo2",
                                    "type": "Microsoft.Common.TextBlock",
                                    "options": {
                                        "text": "If VPN is selected and RouteServer is 'New', a RouteServer will be deployed in the same virtual network as selected in the section above. A RouteServerSubnet will be required for this deployment and can be specified below",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "OnpremiseConnect",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": "",
                            "label": "How does Azure connect to On-premises?",
                            "defaultValue": "ExpressRoute",
                            "toolTip": "",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "ExpressRoute",
                                        "value": false
                                    },
                                    {
                                        "label": "VPN",
                                        "value": true
                                    }
                                ]
                            }
                        },
                        {
                            "name": "DeployRouteServer",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": "[equals(steps('azureNetwork').OnpremiseConnect, true)]",
                            "label": "Deploy Route Server",
                            "defaultValue": "No",
                            "toolTip": "",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": true
                                    },
                                    {
                                        "label": "No",
                                        "value": false
                                    }
                                ]
                            }
                        },
                        {
                            "name": "VnetSelectorId",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "visible": "[equals(steps('azureNetwork').DeployRouteServer, true)]",
                            "label": "Virtual Network",
                            "resourceType": "Microsoft.Network/virtualNetworks",
                            "constraints": {
                                "required": true
                            },
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            }
                        },
                        {
                            "name": "RouteServerSubnetExists",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": "[equals(steps('azureNetwork').DeployRouteServer, true)]",
                            "label": "RouteServer Subnet",
                            "defaultValue": "No",
                            "toolTip": "",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "New",
                                        "value": false
                                    },
                                    {
                                        "label": "Existing",
                                        "value": true
                                    }
                                ]
                            }
                        },
                        {
                            "name": "RouteServerSubnetPrefix",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[equals(steps('azureNetwork').RouteServerSubnetExists, false)]",
                            "label": "RouteServer Subnet Prefix",
                            "toolTip": "Subnet for the Azure RouteServer",
                            "defaultValue": "192.168.2.0/24",
                            "placeholder": "Example: 192.168.2.0/24",
                            "constraints": {
                                "required": true,
                                "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(1[0-9]|2[0-4]))$",
                                "validationMessage": "Invalid CIDR range. The address prefix must be in the range 10 to 24."
                            }
                        },
                        {
                            "name": "RouteServerSubnetPrefixInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[equals(steps('azureNetwork').RouteServerSubnetExists, false)]",
                            "options": {
                                "text": "Ensure that the subnet prefix is valid and is in the range of the chosen VNet above ",
                                "uri": "",
                                "style": "Info"
                            }
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "Prefix": "[steps('basics').avsDeploymentPrefix]",
                "Location": "[steps('basics').avsDeploymentScope.location.name]",
                "VNetName": "[steps('azureNetwork').VnetSelectorId.name]",
                "RouteServerSubnetExists": "[steps('azureNetwork').RouteServerSubnetExists]",
                "RouteServerSubnetPrefix": "[if(equals(steps('azureNetwork').RouteServerSubnetExists, false), steps('azureNetwork').RouteServerSubnetPrefix, 'none')]"
            },
            "kind": "Subscription",
            "location": "[steps('basics').avsDeploymentScope.location.name]",
            "subscriptionId": "[steps('basics').avsDeploymentScope.subscription.id]"
        }
    }
}